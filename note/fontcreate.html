<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>8x16 2bit Font Generator (Strict)</title>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: #eee; padding: 20px; }
        .box { background: #333; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        canvas { background: #000; border: 1px solid #fff; image-rendering: pixelated; width: 128px; height: 256px; }
        textarea { width: 100%; height: 200px; background: #000; color: #0f0; font-family: monospace; }
        .preview-group { display: flex; gap: 30px; align-items: flex-start; }
    </style>
</head>
<body>
    <div class="box">
        <h1>8x16 2bit Font Generator (Strict Order)</h1>
        <div class="preview-group">
            <div>
                <label>確認文字:</label><br>
                <input type="text" id="char" value="A" maxlength="1" style="font-size:20px; width:50px;"><br><br>
                <canvas id="cvs" width="8" height="16"></canvas>
            </div>
            <div style="flex-grow:1">
                <p>現在のビット配置仕様:</p>
                <ul>
                    <li>1行 = 2バイト</li>
                    <li>Byte[0]: ピクセル0(ビット7-6) 〜 ピクセル3(ビット1-0)</li>
                    <li>Byte[1]: ピクセル4(ビット7-6) 〜 ピクセル7(ビット1-0)</li>
                </ul>
                <button id="genBtn" style="padding:10px 20px; cursor:pointer;">全256文字 出力</button>
            </div>
        </div>
    </div>
    <textarea id="out" readonly></textarea>

<script>
const cvs = document.getElementById('cvs');
const ctx = cvs.getContext('2d', {alpha: false});
const charInput = document.getElementById('char');
const out = document.getElementById('out');

function render(char) {
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, 8, 16);
    ctx.fillStyle = "white";
    // 確実に中央、かつ8x16に収まるフォントサイズ
    ctx.font = "14px monospace";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(char, 4, 8);
}

function generateCharData(char) {
    render(char);
    const imgData = ctx.getImageData(0, 0, 8, 16).data;
    let bytes = [];

    for (let y = 0; y < 16; y++) {
        let b = [0, 0]; // 1行2バイト
        for (let x = 0; x < 8; x++) {
            const i = (y * 8 + x) * 4;
            // 4階調(0-3)
            const val = Math.floor(imgData[i] / 64);
            
            const byteIdx = x < 4 ? 0 : 1;
            const bitShift = (3 - (x % 4)) * 2;
            b[byteIdx] |= (val << bitShift);
        }
        bytes.push("0x" + b[0].toString(16).toUpperCase().padStart(2, '0'));
        bytes.push("0x" + b[1].toString(16).toUpperCase().padStart(2, '0'));
    }
    return bytes.join(", ");
}

charInput.oninput = () => render(charInput.value);
document.getElementById('genBtn').onclick = () => {
    let res = "const unsigned char font_table[256][32] = {\n";
    for(let i=0; i<256; i++) {
        const c = String.fromCharCode(i);
        res += `    { ${generateCharData(c)} }, // [${i}] '${(i<32?' ':c)}'\n`;
    }
    res += "};";
    out.value = res;
    alert("完了しました。");
};
render("A");
</script>
</body>
</html>