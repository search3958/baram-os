nasm -f elf32 boot.s -o boot.o
nasm -f elf32 isr.s -o isr.o

i686-elf-gcc -I. -c kernel.c -o kernel.o -ffreestanding -O3 -Wall -m32 -march=pentium4 -mno-80387
i686-elf-gcc -I. -c drivers.c -o drivers.o -ffreestanding -O3 -Wall -m32 -march=pentium4 -mno-80387

i686-elf-gcc -T link.ld -o kernel.bin boot.o isr.o kernel.o drivers.o -ffreestanding -O3 -m32 -nostdlib -lgcc

mkdir -p isodir/boot/grub
cp kernel.bin isodir/boot/
cp grub.cfg isodir/boot/grub/
i686-elf-grub-mkrescue -o os.iso isodir

qemu-system-i386 -cdrom os.iso -vga std \
-m 1G \
-smp 4 \
-cpu coreduo \
-rtc base=localtime \
-net none \
-accel tcg,thread=multi \
-display cocoa